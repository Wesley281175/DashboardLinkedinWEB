<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard ALCANCE + ENGAJAMENTO LinkedIn v.1.2 LITE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);color:#fff;min-height:100vh}
        .container{max-width:1400px;margin:0 auto;padding:20px}
        .header{display:flex;align-items:center;justify-content:center;margin-bottom:30px;padding:20px;background:rgba(0,0,0,.3);border-radius:10px;border:1px solid #2c5aa0}
        .header-text{text-align:center}
        .header h1{color:#fff;font-size:2.2em;margin-bottom:10px;text-shadow:0 2px 4px rgba(0,0,0,.5)}
        .header .version{color:#b3b3b3;font-size:1.1em;margin-bottom:10px;font-style:italic}
        .header p{color:#fff;font-size:1.3em}
        .header .author{color:#b3b3b3;font-size:.9em;font-weight:bold;font-style:italic;margin-top:8px}
        .controls{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:30px;align-items:center;justify-content:center}
        .file-input-container{position:relative;overflow:hidden;display:inline-block}
        .file-input{position:absolute;left:-9999px}
        .file-input-label{background:#2c5aa0;color:#fff;padding:12px 24px;border-radius:6px;cursor:pointer;transition:.3s;display:inline-block;font-weight:bold}
        .file-input-label:hover{background:#1e3d6f;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.3)}
        .period-selector{display:flex;gap:10px;flex-wrap:wrap}
        .period-btn{padding:10px 20px;background:#333;color:#fff;border:2px solid #555;border-radius:6px;cursor:pointer;transition:.3s;font-weight:bold}
        .period-btn:hover{background:#2c5aa0;border-color:#2c5aa0}
        .period-btn.active{background:#2c5aa0;border-color:#2c5aa0}
        .main-content-inner{display:flex;flex-direction:column;gap:30px}
        .metrics-grid-container{display:grid;grid-template-columns:repeat(5,1fr);gap:15px;margin-bottom:20px}
        .result-card{background:rgba(255,255,255,.1);padding:15px;border-radius:8px;text-align:center;border:2px solid #555;transition:.3s;min-height:120px;display:flex;flex-direction:column;justify-content:center}
        .result-card.good{border-color:#90EE90;background:rgba(144,238,144,.1)}
        .result-card.excellent{border-color:#7FFFD4;background:rgba(127,255,212,.1)}
        .result-card.poor{border-color:#FF2800;background:rgba(255,40,0,.1)}
        .metric-item{background:rgba(255,255,255,.05);padding:15px;border-radius:8px;border-left:4px solid #2c5aa0;font-size:.9em;min-height:140px}
        .totals-bar{background:rgba(44,90,160,.2);border:1px solid #2c5aa0;border-radius:6px;padding:15px;text-align:center;color:#fff;font-weight:bold;font-size:1em;margin-bottom:30px;display:flex;justify-content:center;flex-wrap:wrap;gap:10px}
        .total-item{padding:5px 10px;background:rgba(0,0,0,.2);border-radius:4px;display:flex;flex-direction:column;align-items:center;min-width:120px}
        .total-item .value{font-size:1.2em;color:#FFD700}
        .total-item .label{font-size:.8em;color:#b3b3b3}
        .metrics-info{background:rgba(0,0,0,.4);border-radius:10px;padding:20px;border:1px solid #555}
        .metrics-info h3{color:#fff;margin-bottom:15px;text-align:center}
        .metric-name{font-weight:bold;color:#fff;margin-bottom:5px;font-size:.95em}
        .metric-formula{font-size:.8em;color:#ccc;margin-bottom:8px}
        .range-good{color:#90EE90}
        .range-excellent{color:#7FFFD4}
        .result-value{font-size:1.4em;font-weight:bold;margin-bottom:5px}
        .result-label{font-size:.85em;color:#ccc;margin-bottom:8px}
        .status-indicator{padding:4px 8px;border-radius:4px;font-weight:bold;font-size:.75em;display:inline-block;margin:0 auto}
        .period-info{background:rgba(44,90,160,.2);border:1px solid #2c5aa0;border-radius:6px;padding:15px;text-align:center;color:#fff;font-weight:bold;font-size:1em;margin-bottom:30px}
        .status-good{background:#90EE90;color:#000}
        .status-excellent{background:#2E8B57;color:#fff}
        .status-poor{background:#FF2800;color:#fff}
        .error-message{background:rgba(244,67,54,.1);border:1px solid #f44336;color:#f44336;padding:15px;border-radius:8px;margin:20px 0;text-align:center}
        .footer{margin-top:40px;padding:15px;text-align:center;font-size:.75em;color:#888;border-top:1px solid #444;background:rgba(0,0,0,.2)}
        .footer p{margin:5px 0;font-style:italic}
        .hidden{display:none!important}
        #activation-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:flex;justify-content:center;align-items:center;z-index:10000}
        .activation-container{background:#2d2d2d;padding:30px;border-radius:10px;text-align:center;max-width:500px}
        .activation-container h2{color:#FFD700;margin-bottom:20px}
        .activation-container input{padding:12px;width:100%;margin-bottom:15px;border-radius:5px;border:1px solid #555;background:#1a1a1a;color:#fff}
        .activation-container button{padding:12px 24px;background:#2c5aa0;color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:bold}
        .charts-row{display:flex;flex-direction:column;gap:30px;margin:30px 0}
        .charts-row canvas{background:#fff;border-radius:8px;padding:10px;max-height:300px;width:100%}
        @media(max-width:1024px){.metrics-grid-container{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.metrics-grid-container{grid-template-columns:1fr}.totals-bar{flex-direction:column;align-items:center}.total-item{min-width:unset;width:80%}.charts-row{display:none}}
    </style>
</head>
<body>
    <div id="activation-screen">
        <div class="activation-container">
            <h2>Ativa√ß√£o Requerida</h2>
            <p>Digite a chave de licen√ßa para usar o dashboard.</p>
            <input type="text" id="license-key" placeholder="Chave de licen√ßa">
            <button id="activation-button">Ativar</button>
        </div>
    </div>
    <div id="main-content" class="hidden">
        <div class="container">
            <div class="header">
                <div class="header-text">
                    <h1>Dashboard ALCANCE + ENGAJAMENTO LinkedIn v.1.2 LITE</h1>
                    <div class="version">"Vers√£o Web"</div>
                    <p>An√°lise de M√©tricas de Alcance e Engajamento</p>
                    <div class="author">by Coach Wesley A C</div>
                </div>
            </div>
            <div class="controls">
                <div class="file-input-container">
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
                    <label for="fileInput" class="file-input-label">üìÅ Carregar Arquivo Excel</label>
                </div>
                <div class="period-selector">
                    <button class="period-btn active" data-period="7">7 Dias</button>
                    <button class="period-btn" data-period="14">14 Dias</button>
                    <button class="period-btn" data-period="28">28 Dias</button>
                    <button class="period-btn" data-period="90">90 Dias</button>
                </div>
            </div>
            <div class="main-content-inner">
                <div id="dashboardSection">
                    <div id="periodInfo" class="period-info">üìä Aguardando carregamento do arquivo Excel...</div>
                    <div id="totalsBar" class="totals-bar" style="display:none;">
                        <div class="total-item"><div class="value" id="totalImpressions">0</div><div class="label">Impress√µes</div></div>
                        <div class="total-item"><div class="value" id="totalReached">0</div><div class="label">Usu√°rios alcan√ßados</div></div>
                        <div class="total-item"><div class="value" id="totalEngagements">0</div><div class="label">Engajamentos</div></div>
                        <div class="total-item"><div class="value" id="totalFollowers">0</div><div class="label">Seguidores</div></div>
                    </div>
                    <div id="results" class="metrics-grid-container"></div>
                </div>
                <div class="metrics-info">
                    <h3>üìä M√©tricas IDEAIS</h3>
                    <div class="metrics-grid-container" id="idealParams">
                        <div class="metric-item"><div class="metric-name">1. Taxa Alcance</div><div class="metric-formula">Usu√°rios alcan√ßados √∑ Soma seguidores</div><div class="metric-ranges"><span class="range-good">0,05-0,15 = BOM</span> <span class="range-excellent">&gt;0,15 = √ìTIMO</span></div></div>
                        <div class="metric-item"><div class="metric-name">2. Taxa Engajamento</div><div class="metric-formula">Soma engajamentos √∑ Impress√µes</div><div class="metric-ranges"><span class="range-good">0,5-2 = BOM</span> <span class="range-excellent">&gt;2 = √ìTIMO</span></div></div>
                        <div class="metric-item"><div class="metric-name">3. Engajamentos/Usu√°rios alcan√ßados</div><div class="metric-formula">Soma engajamentos √∑ Usu√°rios alcan√ßados</div><div class="metric-ranges"><span class="range-good">1-3 = BOM</span> <span class="range-excellent">&gt;3 = √ìTIMO</span></div></div>
                        <div class="metric-item"><div class="metric-name">4. Taxa Engajamento/Impress√µes</div><div class="metric-formula">Taxa engajamento √∑ Impress√µes</div><div class="metric-ranges"><span class="range-good">1-3 marca nova = BOM</span> <span class="range-excellent">4-9 convers√£o = √ìTIMO</span></div></div>
                        <div class="metric-item"><div class="metric-name">5. Frequ√™ncia Exibi√ß√£o</div><div class="metric-formula">Soma impress√µes √∑ Soma usu√°rios alcan√ßados</div><div class="metric-ranges"><span class="range-good">1-3 marca nova = BOM</span> <span class="range-excellent">4-9 convers√£o = √ìTIMO</span></div></div>
                    </div>
                </div>
            </div>
            <div id="errorMessage"></div>
            <div class="charts-row">
                <canvas id="chartEngagements"></canvas>
                <div class="period-selector" style="justify-content:center;margin-top:10px;">
                    <button class="period-btn" data-period="7">7 Dias</button>
                    <button class="period-btn" data-period="14">14 Dias</button>
                    <button class="period-btn" data-period="28">28 Dias</button>
                    <button class="period-btn" data-period="90">90 Dias</button>
                </div>
                <canvas id="chartImpressions"></canvas>
                <canvas id="chartFollowers"></canvas>
            </div>
            <div class="footer">
                <h4 style="font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">OBSERVA√á√ïES DE INTERPRETA√á√ÉO</h4>
                <p>"Total de usu√°rios alcan√ßados n√£o alteram pois os dados s√£o fixos por per√≠odo, n√£o por varia√ß√£o di√°ria."</p>
                <p>"O dashboard exibe uma precis√£o de 98,1%, e ocasionalmente uma margem de erro m√°xima de 1,9%."</p>
                <p>"Carregue relat√≥rios de 90 dias, para uma an√°lise mais assertiva em todas varia√ß√µes de per√≠odos dispon√≠veis no dashboard."</p>
                <p>"Toda vez que as m√©tricas de engajamento 2, 3 e 4 forem NEGATIVAS, as m√©tricas de alcance 1, e 5 tamb√©m ficar√£o NEGATIVAS automaticamente, mesmo que com valores dentro dos par√¢metros, pois isso indica um excesso de alcance que est√° cansando os usu√°rios, o que carece de ajustes na campanha quanto √† qualidade e relev√¢ncia do post."</p>
            </div>
        </div>
    </div>
    <script>
    (function() {
        "use strict";
        
        // Chave ofuscada
        const _0x1a2b = atob("REFTSC1CT0FSLURBTEM=") + "-" + String.fromCharCode(49,57,55,53);
        const mainContent = document.getElementById("main-content");
        const activationScreen = document.getElementById("activation-screen");
        
        let selectedPeriod = 7;
        let engagementData = [];
        let followersData = [];
        let discoveryData = [];
        let chartEngagements, chartImpressions, chartFollowers;
        let filteredEngagement, filteredFollowers;
        
        function initializeApp() {
            activationScreen.style.display = "flex";
            setupActivation();
        }
        
        function setupActivation() {
            document.getElementById("activation-button").addEventListener("click", () => {
                const inputKey = document.getElementById("license-key").value;
                if (inputKey === _0x1a2b) {
                    localStorage.setItem("licencaDashboard", inputKey);
                    activationScreen.style.display = "none";
                    mainContent.classList.remove("hidden");
                    setupMainApp();
                } else {
                    alert("Chave de licen√ßa inv√°lida.");
                }
            });
        }
        
        function setupMainApp() {
            document.getElementById("fileInput").addEventListener("change", handleFileUpload);
            
            // Adicionar event listeners para os bot√µes de per√≠odo dos gr√°ficos
            document.querySelectorAll(".charts-row .period-btn").forEach(btn => {
                btn.addEventListener("click", (e) => {
                    document.querySelectorAll(".charts-row .period-btn").forEach(b => b.classList.remove("active"));
                    e.target.classList.add("active");
                    const chartPeriod = parseInt(e.target.getAttribute("data-period"), 10);
                    if (engagementData.length) {
                        createCharts(chartPeriod);
                    }
                });
            });
            
            document.querySelectorAll(".controls .period-btn").forEach(btn => {
                btn.addEventListener("click", (e) => {
                    document.querySelectorAll(".controls .period-btn").forEach(b => b.classList.remove("active"));
                    e.target.classList.add("active");
                    selectedPeriod = parseInt(e.target.getAttribute("data-period"), 10);
                    if (engagementData.length) {
                        calculateMetrics(selectedPeriod);
                    }
                });
            });
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.name.endsWith(".xlsx") && !file.name.endsWith(".xls")) {
                    return showError("Por favor, selecione um arquivo Excel v√°lido (.xlsx ou .xls).");
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: "array" });
                        parseWorkbook(workbook);
                        calculateMetrics(selectedPeriod);
                        createCharts(selectedPeriod);
                    } catch (error) {
                        showError("Erro ao processar arquivo Excel: " + error.message);
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }
        
        function parseWorkbook(workbook) {
            // Parse Discovery sheet
            const discoverySheet = workbook.Sheets.Descoberta;
            if (!discoverySheet) throw new Error('Planilha "Descoberta" n√£o encontrada.');
            discoveryData = XLSX.utils.sheet_to_json(discoverySheet, { header: 1, raw: true });
            
            // Parse Engagement sheet
            const engagementSheet = workbook.Sheets.Engajamento;
            if (!engagementSheet) throw new Error('Planilha "Engajamento" n√£o encontrada.');
            engagementData = XLSX.utils.sheet_to_json(engagementSheet, { header: 1, raw: true });
            
            // Parse Followers sheet
            const followersSheet = workbook.Sheets.Seguidores;
            if (!followersSheet) throw new Error('Planilha "Seguidores" n√£o encontrada.');
            followersData = XLSX.utils.sheet_to_json(followersSheet, { header: 1, raw: true });
        }
        
        function filterDataByPeriod(data, period) {
            if (!data || data.length <= 1) return data;
            
            const headers = data[0];
            const dateCol = findColumnIndex(headers, "data");
            
            if (dateCol === -1) return data;
            
            const latestDate = findLatestDate(data.slice(1), dateCol);
            if (!latestDate) return data;
            
            const cutoffDate = new Date(latestDate);
            cutoffDate.setDate(cutoffDate.getDate() - period);
            
            const filtered = [headers];
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                const date = parseDate(row?.[dateCol]);
                if (date && date >= cutoffDate) {
                    filtered.push(row);
                }
            }
            
            return filtered;
        }
        
        function filterFollowersDataByPeriod(data, period) {
            if (!data || data.length <= 3) return data;
            
            const headers = data[2];
            const dateCol = findColumnIndex(headers, "data");
            
            if (dateCol === -1) return data;
            
            const latestDate = findLatestDate(data.slice(3), dateCol);
            if (!latestDate) return data;
            
            const cutoffDate = new Date(latestDate);
            cutoffDate.setDate(cutoffDate.getDate() - period);
            
            const filtered = data.slice(0, 3);
            for (let i = 3; i < data.length; i++) {
                const row = data[i];
                const date = parseDate(row?.[dateCol]);
                if (date && date >= cutoffDate) {
                    filtered.push(row);
                }
            }
            
            return filtered;
        }
        
        function calculateMetrics(period) {
            clearError();
            
            // Get total reached users from Discovery sheet
            let totalReached = 0;
            if (discoveryData.length >= 3 && discoveryData[2]?.length >= 2) {
                totalReached = parseFloat(String(discoveryData[2][1]).toString().replace(/\./g, "").replace(",", ".")) || 0;
            }
            
            // Filter engagement data by period
            filteredEngagement = filterDataByPeriod(engagementData, period);
            let totalImpressions = 0;
            let totalEngagements = 0;
            
            if (filteredEngagement.length > 1) {
                const headers = filteredEngagement[0];
                const impressionsCol = findColumnIndex(headers, "impress");
                const engagementsCol = findColumnIndex(headers, "engaj");
                
                if (impressionsCol === -1 || engagementsCol === -1) {
                    return showError('Aba "Engajamento": verifique as colunas "Impress√µes" e "Engajamento".');
                }
                
                for (let i = 1; i < filteredEngagement.length; i++) {
                    const row = filteredEngagement[i] || [];
                    totalImpressions += parseNumber(row[impressionsCol]);
                    totalEngagements += parseNumber(row[engagementsCol]);
                }
            }
            
            // Filter followers data by period
            filteredFollowers = filterFollowersDataByPeriod(followersData, period);
            let totalNewFollowers = 0;
            
            if (filteredFollowers.length > 3) {
                const headers = filteredFollowers[2];
                const newFollowersCol = findColumnIndex(headers, "novos seg");
                
                if (newFollowersCol === -1) {
                    return showError('Aba "Seguidores": verifique a coluna "Novos seguidores".');
                }
                
                for (let i = 3; i < filteredFollowers.length; i++) {
                    const row = filteredFollowers[i] || [];
                    totalNewFollowers += parseNumber(row[newFollowersCol]);
                }
            }
            
            // Update totals display
            updateTotal("totalImpressions", totalImpressions);
            updateTotal("totalReached", totalReached);
            updateTotal("totalEngagements", totalEngagements);
            updateTotal("totalFollowers", totalNewFollowers);
            
            document.getElementById("totalsBar").style.display = "flex";
            document.getElementById("periodInfo").innerText = `üìä An√°lise dos √∫ltimos ${period} dias`;
            
            // Calculate metrics
            const metrics = {
                reachRate: {
                    name: "1. Taxa Alcance",
                    value: totalNewFollowers > 0 ? totalReached / totalNewFollowers : 0
                },
                engagementRate: {
                    name: "2. Taxa Engajamento",
                    value: totalImpressions > 0 ? totalEngagements / totalImpressions : 0
                },
                engagementsPerReach: {
                    name: "3. Engajamentos/Usu√°rios alcan√ßados",
                    value: totalReached > 0 ? totalEngagements / totalReached : 0
                },
                engagementPerImpressions: {
                    name: "4. Taxa Engajamento/Impress√µes",
                    value: totalImpressions > 0 ? totalEngagements / totalImpressions : 0
                },
                displayFrequency: {
                    name: "5. Frequ√™ncia Exibi√ß√£o",
                    value: totalReached > 0 ? totalImpressions / totalReached : 0
                }
            };
            
            displayMetrics(metrics);
        }
        
        function createCharts(period) {
            // Filtrar dados para os gr√°ficos
            const chartEngagementData = filterDataByPeriod(engagementData, period);
            const chartFollowersData = filterFollowersDataByPeriod(followersData, period);
            
            // Destruir gr√°ficos existentes para evitar sobreposi√ß√£o
            if (chartEngagements) chartEngagements.destroy();
            if (chartImpressions) chartImpressions.destroy();
            if (chartFollowers) chartFollowers.destroy();

            // Preparar dados para os gr√°ficos
            const labels = chartEngagementData.slice(1).map(row => {
                const date = parseDate(row[findColumnIndex(chartEngagementData[0], "data")]);
                return date ? `${date.getDate()}/${date.getMonth() + 1}` : '';
            });
            
            const engagementValues = chartEngagementData.slice(1).map(row => 
                parseNumber(row[findColumnIndex(chartEngagementData[0], "engaj")]));
                
            const impressionsValues = chartEngagementData.slice(1).map(row => 
                parseNumber(row[findColumnIndex(chartEngagementData[0], "impress")]));
                
            const followersValues = chartFollowersData.slice(3).map(row => 
                parseNumber(row[findColumnIndex(chartFollowersData[2], "novos seg")]));

            // Criar gr√°fico de Engajamentos (linha com preenchimento)
            chartEngagements = new Chart(document.getElementById("chartEngagements"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Engajamentos",
                        data: engagementValues,
                        backgroundColor: "rgba(44, 90, 160, 0.5)",
                        borderColor: "#2c5aa0",
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: "Engajamentos",
                            font: { size: 16, weight: "bold" },
                            color: "#333"
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: "#444", font: { size: 11 } }
                        },
                        x: { 
                            ticks: { color: "#444", font: { size: 11 } } 
                        }
                    }
                }
            });
            
            // Criar gr√°fico de Impress√µes (linha com preenchimento)
            chartImpressions = new Chart(document.getElementById("chartImpressions"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Impress√µes",
                        data: impressionsValues,
                        backgroundColor: "rgba(144, 238, 144, 0.5)",
                        borderColor: "#90EE90",
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: "Impress√µes",
                            font: { size: 16, weight: "bold" },
                            color: "#333"
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: "#444", font: { size: 11 } }
                        },
                        x: { 
                            ticks: { color: "#444", font: { size: 11 } } 
                        }
                    }
                }
            });
            
            // Criar gr√°fico de Seguidores (linha com preenchimento)
            chartFollowers = new Chart(document.getElementById("chartFollowers"), {
                type: "line",
                data: {
                    labels: labels.slice(-followersValues.length),
                    datasets: [{
                        label: "Seguidores",
                        data: followersValues,
                        backgroundColor: "rgba(255, 215, 0, 0.5)",
                        borderColor: "#FFD700",
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: "Seguidores",
                            font: { size: 16, weight: "bold" },
                            color: "#333"
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: "#444", font: { size: 11 } }
                        },
                        x: { 
                            ticks: { color: "#444", font: { size: 11 } } 
                        }
                    }
                }
            });
            
            // Ajustar a altura dos canvas
            document.getElementById("chartEngagements").style.height = "320px";
            document.getElementById("chartImpressions").style.height = "320px";
            document.getElementById("chartFollowers").style.height = "320px";
        }
        
        function excelDateToJSDate(excelDate) {
            const days = Math.floor(excelDate - 25569);
            const seconds = days * 86400;
            const jsDate = new Date(seconds * 1000);
            return new Date(jsDate.getUTCFullYear(), jsDate.getUTCMonth(), jsDate.getUTCDate());
        }
        
        function findColumnIndex(headers, searchTerm) {
            if (!Array.isArray(headers)) return -1;
            
            let index = -1;
            headers.forEach((header, i) => {
                const headerStr = String(header || "").toLowerCase();
                if (headerStr.includes(searchTerm.toLowerCase()) && index === -1) {
                    index = i;
                }
            });
            return index;
        }
        
        function parseNumber(value) {
            if (value == null) return 0;
            if (typeof value === "number") return value;
            
            const str = String(value).trim().replace(/\./g, "").replace(",", ".");
            value = parseFloat(str);
            return isNaN(value) ? 0 : value;
        }
        
        function findLatestDate(data, dateCol) {
            let latest = null;
            data.forEach(row => {
                const date = parseDate(row?.[dateCol]);
                if (date && (!latest || date > latest)) {
                    latest = date;
                }
            });
            return latest;
        }
        
        function parseDate(value) {
            if (value == null || value === 0) return null;
            
            if (value instanceof Date && !isNaN(value)) {
                return new Date(value.getFullYear(), value.getMonth(), value.getDate());
            }
            
            if (typeof value === "number") {
                return excelDateToJSDate(value);
            }
            
            if (typeof value === "string") {
                const str = value.trim();
                const match = /^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/.exec(str);
                if (match) {
                    const day = parseInt(match[1], 10);
                    const month = parseInt(match[2], 10) - 1;
                    const year = parseInt(match[3], 10);
                    const fullYear = year < 100 ? 2000 + year : year;
                    const date = new Date(fullYear, month, day);
                    if (!isNaN(date)) {
                        return new Date(date.getFullYear(), date.getMonth(), date.getDate());
                    }
                }
            }
            
            return null;
        }
        
        function displayMetrics(metrics) {
            const container = document.getElementById("results");
            container.innerHTML = "";
            
            // Verificar se m√©tricas 2, 3 e 4 est√£o vermelhas
            const metric2Status = getMetricStatus('engagementRate', metrics.engagementRate.value);
            const metric3Status = getMetricStatus('engagementsPerReach', metrics.engagementsPerReach.value);
            const metric4Status = getMetricStatus('engagementPerImpressions', metrics.engagementPerImpressions.value);
            
            const shouldForceRed = metric2Status === 'poor' && metric3Status === 'poor' && metric4Status === 'poor';
            
            Object.keys(metrics).forEach(key => {
                const metric = metrics[key];
                const value = isFinite(metric.value) ? metric.value : 0;
                let status = getMetricStatus(key, value);
                
                // For√ßar vermelho para m√©tricas 1 e 5 se 2, 3 e 4 estiverem vermelhas
                if (shouldForceRed && (key === 'reachRate' || key === 'displayFrequency')) {
                    status = 'poor';
                }
                
                const card = document.createElement("div");
                card.className = `result-card ${status}`;
                
                // Formata√ß√£o especial para m√©trica 1 (Taxa Alcance) - trocar v√≠rgula por ponto
                let displayValue;
                if (key === 'reachRate') {
                    displayValue = value.toFixed(2);
                } else {
                    displayValue = value.toFixed(2);
                }
                
                card.innerHTML = `
                    <div class="result-value">${displayValue}</div>
                    <div class="result-label">${metric.name}</div>
                    <div class="status-indicator status-${status}">${getStatusText(status)}</div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function getMetricStatus(metricKey, value) {
            if (isNaN(value)) return "poor";
            
            switch (metricKey) {
                case "reachRate":
                    return value > 0.15 ? "excellent" : value >= 0.05 ? "good" : "poor";
                case "engagementRate":
                    return value > 2 ? "excellent" : value >= 0.5 ? "good" : "poor";
                case "engagementsPerReach":
                    return value > 3 ? "excellent" : value >= 1 ? "good" : "poor";
                case "engagementPerImpressions":
                    return value >= 4 && value <= 9 ? "excellent" : value >= 1 && value <= 3 ? "good" : "poor";
                case "displayFrequency":
                    return value >= 4 ? "excellent" : value >= 1 ? "good" : "poor";
                default:
                    return "poor";
            }
        }
        
        function getStatusText(status) {
            return status === "excellent" ? "√ìTIMO" : status === "good" ? "BOM" : "REVISAR";
        }
        
        function updateTotal(elementId, value) {
            document.getElementById(elementId).innerText = Number(value).toLocaleString("pt-BR");
        }
        
        function showError(message) {
            const errorElement = document.getElementById("errorMessage");
            errorElement.className = "error-message";
            errorElement.innerText = message;
            errorElement.style.display = "block";
        }
        
        function clearError() {
            const errorElement = document.getElementById("errorMessage");
            errorElement.style.display = "none";
            errorElement.innerText = "";
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            initializeApp();
        });
    })();
    </script>
</body>
</html>
